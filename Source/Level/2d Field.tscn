[gd_scene load_steps=9 format=3 uid="uid://c7s2105hmxa22"]

[ext_resource type="Script" uid="uid://c34w6bu1r0pps" path="res://Source/Level/2d_field.gd" id="1_g6hoy"]
[ext_resource type="PackedScene" uid="uid://dqah76ms2b768" path="res://Source/Level/World 3d/World.tscn" id="2_1nqvx"]
[ext_resource type="Script" uid="uid://dc4pngsku15ca" path="res://Source/Level/sub_viewport_container.gd" id="2_sdw6a"]
[ext_resource type="PackedScene" uid="uid://cc80kys2ggc2w" path="res://Source/Unit/UnitHP.tscn" id="4_m3ml2"]
[ext_resource type="Script" uid="uid://dq4lj4ye45p6e" path="res://Source/Level/targeting_control.gd" id="6_j1hex"]
[ext_resource type="Script" uid="uid://bcjbv88jvpqu3" path="res://Source/Level/RerollHandler.gd" id="7_c3iwq"]
[ext_resource type="Script" uid="uid://cy7chstagykgi" path="res://Source/Level/TurnManager.gd" id="8_v11ag"]
[ext_resource type="Script" uid="uid://dbkjwamglevpw" path="res://Source/Level/enemy_instancer.gd" id="9_6x6jb"]

[node name="Node2D" type="Node2D"]
script = ExtResource("1_g6hoy")

[node name="DiceContainer" type="SubViewportContainer" parent="." node_paths=PackedStringArray("viewport")]
offset_left = 832.0
offset_top = 279.0
offset_right = 1344.0
offset_bottom = 791.0
script = ExtResource("2_sdw6a")
viewport = NodePath("SubViewport")

[node name="SubViewport" type="SubViewport" parent="DiceContainer"]
handle_input_locally = false
physics_object_picking = true
render_target_update_mode = 4

[node name="World" parent="DiceContainer/SubViewport" node_paths=PackedStringArray("units") instance=ExtResource("2_1nqvx")]
units = [NodePath("../../../Player/Head"), NodePath("../../../Player/ArmL"), NodePath("../../../Player/ArmR"), NodePath("../../../Player/LegL"), NodePath("../../../Player/LegR")]

[node name="Player" type="Node2D" parent="."]

[node name="Head" parent="Player" instance=ExtResource("4_m3ml2")]
offset_left = 113.0
offset_top = 52.0
offset_right = 513.0
offset_bottom = 180.0

[node name="ArmL" parent="Player" instance=ExtResource("4_m3ml2")]
offset_left = 71.0
offset_top = 422.0
offset_right = 471.0
offset_bottom = 550.0

[node name="ArmR" parent="Player" instance=ExtResource("4_m3ml2")]
offset_left = 508.0
offset_top = 305.0
offset_right = 908.0
offset_bottom = 433.0

[node name="LegL" parent="Player" instance=ExtResource("4_m3ml2")]
offset_left = 36.0
offset_top = 754.0
offset_right = 436.0
offset_bottom = 882.0

[node name="LegR" parent="Player" instance=ExtResource("4_m3ml2")]
offset_left = 569.0
offset_top = 654.0
offset_right = 969.0
offset_bottom = 782.0

[node name="Targeting Control" type="Node" parent="Player" node_paths=PackedStringArray("turn_manager")]
script = ExtResource("6_j1hex")
turn_manager = NodePath("../../End Turn")

[node name="Roll Control" type="Node" parent="." node_paths=PackedStringArray("dice_roller", "targeting", "button")]
script = ExtResource("7_c3iwq")
dice_roller = NodePath("../DiceContainer/SubViewport/World")
targeting = NodePath("../Player/Targeting Control")
button = NodePath("../Reroll")

[node name="Reroll" type="Button" parent="."]
anchors_preset = 2
anchor_top = 1.0
anchor_bottom = 1.0
offset_left = 2.0
offset_top = 967.0
offset_right = 245.0
offset_bottom = 1079.0
grow_vertical = 0
text = "Reroll (2/2)"

[node name="End Turn" type="Button" parent="." node_paths=PackedStringArray("enemy_manager", "player_control")]
offset_left = 1597.0
offset_top = 982.0
offset_right = 1911.0
offset_bottom = 1088.0
text = "End Turn"
script = ExtResource("8_v11ag")
enemy_manager = NodePath("../Enemy Manager")
player_control = NodePath("../Player/Targeting Control")

[node name="Enemy Manager" type="Node2D" parent="." node_paths=PackedStringArray("dice_world", "turn_manager", "player_targeting_control")]
position = Vector2(1098, 138)
script = ExtResource("9_6x6jb")
dice_world = NodePath("../DiceContainer/SubViewport/World")
turn_manager = NodePath("../End Turn")
player_targeting_control = NodePath("../Player/Targeting Control")

[connection signal="pressed" from="End Turn" to="End Turn" method="_on_pressed"]
